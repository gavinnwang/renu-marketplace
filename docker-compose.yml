services:
  marketplace:
    image: marketplace:latest
    container_name: marketplace
    restart: unless-stopped
    ports:
      - "8080:8080"
    networks:
      - app-network
  webserver:
    image: nginx:latest
    container_name: webserver
    restart: unless-stopped
    ports:
      - "80:80"
    volumes:
      - ./nginx-conf:/etc/nginx/conf.d
      # - certbot-etc:/etc/letsencrypt
      # - certbot-var:/var/lib/letsencrypt
    depends_on:
      - marketplace
    networks:
      - app-network
  certbot:
    image: certbot/certbot
    container_name: certbot
    volumes:
      - certbot-etc:/etc/letsencrypt
      - certbot-var:/var/lib/letsencrypt
      - web-root:/var/www/html
    depends_on:
      - webserver
    command: certonly --webroot --webroot-path=/var/www/html --email gavinwang@gmail.com --agree-tos --no-eff-email --staging -d gavinwang.dev  -d www.gavinwang.dev 
networks:
  app-network:
    driver: bridge  